#!/usr/bin/env bash

set -e

BASE_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

sudo apt-get install -y socat python-dev libtool python-setuptools autoconf automake

sudo npm install scuttlebot -g --unsafe-perm

currentUser=$USER

sudo cp "$BASE_DIR/ssb.service" /etc/systemd/system/ssb.service
sudo sed -i "s|__USER__|${currentUser}|g" /etc/systemd/system/ssb.service

sudo systemctl daemon-reload
sudo systemctl enable ssb.service
sudo systemctl start ssb.service

sudo cp "$BASE_DIR/ssb-broadcast-service.sh" "/usr/local/bin/ssb-broadcast-service.sh"
sudo cp "$BASE_DIR/ssb-broadcast.service" /etc/systemd/system/ssb-broadcast.service
sudo sed -i "s|__USER__|${currentUser}|g" /etc/systemd/system/ssb-broadcast.service

sudo systemctl daemon-reload
sudo systemctl enable ssb-broadcast.service
